# 邮件通知配置指南

## 功能说明

GitHub Action 现在支持自动发送选股结果邮件通知，每次策略运行成功后会自动发送包含选股结果的精美HTML邮件。

## 配置步骤

### 1. 本地配置（可选）

如果你想在本地测试邮件功能，可以创建 `user_config.py` 文件：

```python
EMAIL_CONFIG = {
    'enabled': True,
    'smtp_server': 'smtp.gmail.com',
    'smtp_port': 587,
    'username': 'your_email@gmail.com',     # 你的邮箱
    'password': 'your_app_password',        # 应用密码
    'to_email': 'your_email@gmail.com',     # 接收邮箱
    'use_tls': True,
    'subject_template': '📈 每日选股推荐 - {date}'
}
```

### 2. GitHub Secrets 配置（必需）

在 GitHub 仓库中设置以下 Secrets：

1. 进入你的 GitHub 仓库
2. 点击 "Settings" → "Secrets and variables" → "Actions"
3. 添加以下 Secrets：

| Secret 名称 | 说明 | 示例值 |
|------------|------|--------|
| `EMAIL_USERNAME` | 发送邮箱地址 | `your_email@gmail.com` |
| `EMAIL_PASSWORD` | 邮箱应用密码 | `your_app_password` |
| `EMAIL_TO` | 接收邮箱地址 | `your_email@gmail.com` |

### 3. Gmail 应用密码设置

如果使用 Gmail，需要设置应用专用密码：

1. 登录 Google 账户
2. 进入 "安全性" → "2步验证"
3. 在 "应用专用密码" 中生成新密码
4. 使用生成的16位密码作为 `EMAIL_PASSWORD`

## 邮件内容

发送的邮件包含：

- 📈 精美的HTML格式
- 🎯 当日选股结果表格
- 📊 股票代码、名称、得分、价格、市值、推荐理由
- ⚠️ 风险提示
- 📎 结果文件附件

## 测试邮件功能

### 本地测试

```bash
# 修改 test_email.py 中的配置
python test_email.py
```

### GitHub Action 测试

1. 在 GitHub Actions 页面手动触发 workflow
2. 查看 Action 日志，确认邮件发送步骤是否成功

## 注意事项

1. **安全性**：邮箱密码存储在 GitHub Secrets 中，不会暴露在代码中
2. **频率控制**：目前只对 `comprehensive` 策略发送邮件，避免重复
3. **失败处理**：邮件发送失败不会影响选股结果的生成和提交
4. **网络要求**：需要能够访问 SMTP 服务器

## 故障排除

### 常见问题

1. **认证失败**
   - 检查邮箱和密码是否正确
   - Gmail 用户需要使用应用专用密码

2. **连接超时**
   - 检查 SMTP 服务器和端口配置
   - 确认网络连接正常

3. **邮件未收到**
   - 检查垃圾邮件文件夹
   - 确认接收邮箱地址正确

### 日志查看

在 GitHub Action 的日志中查看邮件发送步骤的详细输出，包含成功/失败信息。

## 自定义配置

你可以修改以下配置来自定义邮件：

- `subject_template`：邮件主题模板
- SMTP 服务器：支持其他邮件服务商
- 邮件内容：修改 `core/email_sender.py` 中的HTML模板 